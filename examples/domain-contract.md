# Example: Domain Contract

This is a real contract excerpt from the NSW v3 Candidate domain. The full contract is 850 lines.

## The Core Value

This contract was generated by one agent in ~2 minutes. An implementation agent then built the entire domain from this contract without asking a single question.

---

## Candidate Domain Contract (Excerpt)

### Domain Overview

| Attribute | Value |
|-----------|-------|
| **Domain** | Candidate |
| **Responsibility** | Candidate profiles, PST scores, constraints, ship dates, path selection |
| **Owner** | Candidate Service |
| **Dependencies** | User (for UserRef), Division (for DivisionRef) |
| **Consumers** | Fitness, Education, Analytics, Dashboard, Alert |

---

### Types

#### Candidate Entity

```typescript
import {
  CandidateId,
  UserId,
  DivisionId,
  NswPath,
  RiskLevel,
  ISODate,
  ISOTimestamp,
  Timestamps
} from '../shared/shared.types';

export interface Candidate extends Timestamps {
  id: CandidateId;
  userId: UserId;
  divisionId: DivisionId;
  firstName: string;
  lastName: string;
  email: string;
  phone: string;
  nswPath: NswPath;
  shipDate: ISODate;
  riskLevel: RiskLevel;
  constraints: CandidateConstraints;
  isActive: boolean;
  enrolledAt: ISOTimestamp;
  deactivatedAt: ISOTimestamp | null;
}
```

#### PstScore Entity

```typescript
export interface PstScore extends Timestamps {
  id: PstScoreId;
  candidateId: CandidateId;
  pushUps: number;
  pullUps: number;
  runSeconds: number;
  swimSeconds: number;
  underwaterPass: boolean;
  recordedAt: ISOTimestamp;
  notes: string | null;
  recordedBy: UserId | null;
  isOfficial: boolean;
}
```

#### Input Types

```typescript
export interface CreateCandidateInput {
  userId: UserId;
  divisionId: DivisionId;
  firstName: string;
  lastName: string;
  email: string;
  phone: string;
  nswPath: NswPath;
  shipDate: ISODate;
  constraints?: Partial<CandidateConstraints>;
}

export interface UpdateCandidateInput {
  firstName?: string;
  lastName?: string;
  email?: string;
  phone?: string;
  nswPath?: NswPath;
}

export interface RecordPstScoreInput {
  pushUps: number;
  pullUps: number;
  runSeconds: number;
  swimSeconds: number;
  underwaterPass: boolean;
  notes?: string;
  isOfficial?: boolean;
}
```

---

### Service Interface

```typescript
export interface ICandidateService {
  /**
   * Creates a new candidate profile
   * @throws CANDIDATE_001 if email already registered
   * @throws CANDIDATE_002 if invalid email format
   * @throws CANDIDATE_003 if invalid phone format
   */
  createCandidate(input: CreateCandidateInput): Promise<ApiResponse<Candidate>>;

  /**
   * Retrieves candidate by ID
   * @throws CANDIDATE_004 if candidate not found
   */
  getCandidateById(candidateId: CandidateId): Promise<ApiResponse<CandidateProfile>>;

  /**
   * Retrieves candidate by user ID
   * @throws CANDIDATE_004 if candidate not found
   */
  getCandidateByUserId(userId: UserId): Promise<ApiResponse<CandidateProfile>>;

  /**
   * Updates candidate profile
   * @throws CANDIDATE_004 if candidate not found
   * @throws CANDIDATE_002 if invalid email format
   */
  updateCandidate(
    candidateId: CandidateId,
    input: UpdateCandidateInput
  ): Promise<ApiResponse<Candidate>>;

  /**
   * Records a new PST score
   * @throws CANDIDATE_004 if candidate not found
   * @throws CANDIDATE_010 if invalid PST score values
   */
  recordPstScore(
    candidateId: CandidateId,
    input: RecordPstScoreInput
  ): Promise<ApiResponse<PstScore>>;

  /**
   * Gets PST score history for candidate
   * @throws CANDIDATE_004 if candidate not found
   */
  getPstHistory(
    candidateId: CandidateId,
    pagination?: PaginationParams
  ): Promise<ApiResponse<PaginatedResponse<PstScore>>>;

  /**
   * Gets most recent PST score
   * @throws CANDIDATE_004 if candidate not found
   */
  getLatestPstScore(candidateId: CandidateId): Promise<ApiResponse<PstScore | null>>;

  /**
   * Updates candidate ship date
   * @throws CANDIDATE_004 if candidate not found
   * @throws CANDIDATE_011 if ship date is in the past
   * @throws CANDIDATE_012 if ship date is less than 4 weeks away
   */
  updateShipDate(
    candidateId: CandidateId,
    shipDate: ISODate
  ): Promise<ApiResponse<Candidate>>;

  /**
   * Updates candidate constraints
   * @throws CANDIDATE_004 if candidate not found
   */
  updateConstraints(
    candidateId: CandidateId,
    constraints: UpdateConstraintsInput
  ): Promise<ApiResponse<Candidate>>;

  /**
   * Lists candidates with filtering
   */
  listCandidates(
    filters?: CandidateFilters,
    pagination?: PaginationParams
  ): Promise<ApiResponse<PaginatedResponse<CandidateProfile>>>;

  /**
   * Gets candidates by division
   */
  getCandidatesByDivision(
    divisionId: DivisionId,
    pagination?: PaginationParams
  ): Promise<ApiResponse<PaginatedResponse<CandidateProfile>>>;

  /**
   * Gets candidates by risk level
   */
  getCandidatesByRiskLevel(
    riskLevel: RiskLevel,
    pagination?: PaginationParams
  ): Promise<ApiResponse<PaginatedResponse<CandidateProfile>>>;
}
```

---

### API Routes

| Method | Path | Request | Response | Auth |
|--------|------|---------|----------|------|
| POST | /api/v1/candidates | CreateCandidateInput | Candidate | Admin |
| GET | /api/v1/candidates/:id | - | CandidateProfile | Candidate, FA, Admin |
| GET | /api/v1/candidates/user/:userId | - | CandidateProfile | Candidate, FA, Admin |
| PATCH | /api/v1/candidates/:id | UpdateCandidateInput | Candidate | Candidate, Admin |
| POST | /api/v1/candidates/:id/pst-scores | RecordPstScoreInput | PstScore | FA, Admin |
| GET | /api/v1/candidates/:id/pst-scores | PaginationParams | PaginatedResponse<PstScore> | Candidate, FA, Admin |
| GET | /api/v1/candidates/:id/pst-scores/latest | - | PstScore | Candidate, FA, Admin |
| PATCH | /api/v1/candidates/:id/ship-date | { shipDate: ISODate } | Candidate | FA, Admin |
| PATCH | /api/v1/candidates/:id/constraints | UpdateConstraintsInput | Candidate | Candidate, Admin |
| GET | /api/v1/candidates | CandidateFilters + PaginationParams | PaginatedResponse<CandidateProfile> | FA, Leadership, Admin |
| GET | /api/v1/divisions/:divisionId/candidates | PaginationParams | PaginatedResponse<CandidateProfile> | FA, Leadership, Admin |

---

### Error Codes

```typescript
export const CandidateErrorCodes = {
  CANDIDATE_001: 'Email already registered',
  CANDIDATE_002: 'Invalid email format',
  CANDIDATE_003: 'Invalid phone format',
  CANDIDATE_004: 'Candidate not found',
  CANDIDATE_005: 'Invalid NSW path',
  CANDIDATE_006: 'Division not found',
  CANDIDATE_007: 'User not found',
  CANDIDATE_008: 'Candidate already exists for this user',
  CANDIDATE_009: 'Cannot deactivate candidate with active training plan',
  CANDIDATE_010: 'Invalid PST score values',
  CANDIDATE_011: 'Ship date must be in the future',
  CANDIDATE_012: 'Ship date must be at least 4 weeks away',
  CANDIDATE_013: 'Invalid age (must be 17-40)',
  CANDIDATE_014: 'Invalid training hours (must be 1-40)',
  CANDIDATE_015: 'Pull-up bar access required for NSW candidates',
  CANDIDATE_016: 'Invalid first name',
  CANDIDATE_017: 'Invalid last name',
  CANDIDATE_018: 'Candidate is deactivated',
  CANDIDATE_019: 'PST score not found',
  CANDIDATE_020: 'Invalid risk level'
} as const;
```

---

### Validation Rules

| Field | Rule | Error Code |
|-------|------|------------|
| email | Valid email format (RFC 5322) | CANDIDATE_002 |
| phone | 10-15 digits after removing non-digit chars | CANDIDATE_003 |
| firstName | 1-50 chars, letters and hyphens only | CANDIDATE_016 |
| lastName | 1-50 chars, letters and hyphens only | CANDIDATE_017 |
| shipDate | Must be at least 4 weeks in the future | CANDIDATE_012 |
| constraints.age | 17-40 | CANDIDATE_013 |
| constraints.trainingHoursPerWeek | 1-40 | CANDIDATE_014 |
| constraints.equipmentAccess.pullUpBar | Must be true | CANDIDATE_015 |
| pstScore.pushUps | 0-200 | CANDIDATE_010 |
| pstScore.pullUps | 0-50 | CANDIDATE_010 |
| pstScore.runSeconds | 300-1800 | CANDIDATE_010 |
| pstScore.swimSeconds | 300-1800 | CANDIDATE_010 |

---

### Database Schema (Prisma)

```prisma
model Candidate {
  id            String   @id @default(cuid())
  userId        String   @unique @map("user_id")
  divisionId    String   @map("division_id")
  firstName     String   @map("first_name")
  lastName      String   @map("last_name")
  email         String   @unique
  phone         String
  nswPath       NswPath  @map("nsw_path")
  shipDate      DateTime @map("ship_date") @db.Date
  riskLevel     RiskLevel @default(YELLOW) @map("risk_level")
  constraints   Json     @default("{}")
  isActive      Boolean  @default(true) @map("is_active")
  enrolledAt    DateTime @default(now()) @map("enrolled_at")
  deactivatedAt DateTime? @map("deactivated_at")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  pstScores     PstScore[]

  @@index([divisionId])
  @@index([riskLevel])
  @@index([shipDate])
  @@index([isActive])
  @@map("candidates")
}

model PstScore {
  id            String   @id @default(cuid())
  candidateId   String   @map("candidate_id")
  pushUps       Int      @map("push_ups")
  pullUps       Int      @map("pull_ups")
  runSeconds    Int      @map("run_seconds")
  swimSeconds   Int      @map("swim_seconds")
  underwaterPass Boolean @map("underwater_pass")
  recordedAt    DateTime @map("recorded_at")
  notes         String?
  recordedBy    String?  @map("recorded_by")
  isOfficial    Boolean  @default(false) @map("is_official")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  candidate     Candidate @relation(fields: [candidateId], references: [id])

  @@index([candidateId])
  @@index([recordedAt])
  @@map("pst_scores")
}
```

---

## Why This Contract Works

### 1. Every Method Has Explicit Error Codes

An implementation agent knows exactly which errors to handle. No guessing.

### 2. Input Types Are Fully Specified

No ambiguity about what fields are required vs optional.

### 3. Validation Rules Are Explicit

The agent implements validation without asking "what are the valid ranges?"

### 4. Database Schema Is Complete

No decisions to make about field names, indexes, or relations.

### 5. API Routes Include Auth Requirements

Implementation knows who can access each endpoint.

---

## Result

The implementation agent produced:
- `candidate.types.ts` (200+ lines)
- `candidate.service.ts` (400+ lines)
- `candidate.repository.ts` (150+ lines)

All from this contract. Zero questions asked. Zero deviations from spec.
